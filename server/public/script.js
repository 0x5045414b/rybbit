!function(){let t=document.currentScript,e=t.getAttribute("src").split("/script.js")[0];if(u&&new Promise((t,e)=>{let r=document.createElement("script");r.src="https://unpkg.com/web-vitals@3/dist/web-vitals.iife.js",r.onload=()=>t(),r.onerror=()=>e(Error("Failed to load web-vitals library")),document.head.appendChild(r)}).then(()=>{C()}).catch(t=>{console.warn("Failed to load web vitals library:",t)}),window.__RYBBIT_OPTOUT__||null!==localStorage.getItem("disable-rybbit")){window.rybbit={pageview(){},event(){},trackOutbound(){},identify(){},clearUserId(){},getUserId:()=>null};return}if(!e){console.error("Please provide a valid analytics host");return}let r=t.getAttribute("data-site-id")||t.getAttribute("site-id");if(!r||isNaN(Number(r))){console.error("Please provide a valid site ID using the data-site-id attribute");return}let a=t.getAttribute("data-debounce")?Math.max(0,parseInt(t.getAttribute("data-debounce"))):500,i="false"!==t.getAttribute("data-auto-track-pageview"),n="false"!==t.getAttribute("data-track-spa"),l="false"!==t.getAttribute("data-track-query"),s="false"!==t.getAttribute("data-track-outbound"),u="true"===t.getAttribute("data-web-vitals"),o=[];try{let c=t.getAttribute("data-skip-patterns");c&&(o=JSON.parse(c),Array.isArray(o)||(o=[]))}catch(p){console.error("Error parsing data-skip-patterns:",p)}let d=[];try{let b=t.getAttribute("data-mask-patterns");b&&(d=JSON.parse(b),Array.isArray(d)||(d=[]))}catch(f){console.error("Error parsing data-mask-patterns:",f)}let g=null;try{let h=localStorage.getItem("rybbit-user-id");h&&(g=h)}catch(y){}function v(t){let e="__DOUBLE_ASTERISK_TOKEN__",r="__SINGLE_ASTERISK_TOKEN__",a=t.replace(/\*\*/g,e).replace(/\*/g,r).replace(/[.+?^${}()|[\]\\]/g,"\\$&"),i=(a=a.replace(/\//g,"\\/")).replace(RegExp(e,"g"),".*").replace(RegExp(r,"g"),"[^/]+");return RegExp("^"+i+"$")}function m(t,e){for(let r of e)try{let a=v(r);if(a.test(t))return r}catch(i){console.error(`Invalid pattern: ${r}`,i)}return null}let w=()=>{let t=new URL(window.location.href),e=t.pathname;if(t.hash&&t.hash.startsWith("#/")&&(e=t.hash.substring(1)),m(e,o))return null;let a=m(e,d);a&&(e=a);let i={site_id:r,hostname:t.hostname,pathname:e,querystring:l?t.search:"",screenWidth:window.innerWidth,screenHeight:window.innerHeight,language:navigator.language,page_title:document.title,referrer:document.referrer};return g&&(i.user_id=g),i},A=t=>{fetch(`${e}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),mode:"cors",keepalive:!0}).catch(console.error)},I=(t="pageview",e="",r={})=>{if("custom_event"===t&&(!e||"string"!=typeof e)){console.error("Event name is required and must be a string for custom events");return}let a=w();if(!a)return;let i={...a,type:t,event_name:e,properties:"custom_event"===t||"outbound"===t?JSON.stringify(r):void 0};A(i)},k={lcp:null,cls:null,inp:null,fcp:null,ttfb:null},E=!1,S=null,T=()=>{if(E)return;let t=Object.values(k).every(t=>null!==t);t&&$()},$=()=>{if(E)return;E=!0,S&&(clearTimeout(S),S=null);let t=w();if(!t)return;let e={...t,type:"performance",event_name:"web-vitals",lcp:k.lcp,cls:k.cls,inp:k.inp,fcp:k.fcp,ttfb:k.ttfb};A(e)},L=t=>{E||(k[t.name.toLowerCase()]=t.value,T())},C=()=>{if("undefined"!=typeof webVitals&&u)try{webVitals.getLCP(L),webVitals.getCLS(L),webVitals.getINP(L),webVitals.getFCP(L),webVitals.getTTFB(L),S=setTimeout(()=>{E||$()},2e4),window.addEventListener("beforeunload",()=>{E||$()})}catch(t){console.warn("Error initializing web vitals tracking:",t)}},O=()=>I("pageview"),P=a>0?function t(e,r){let a;return(...t)=>{clearTimeout(a),a=setTimeout(()=>e.apply(this,t),r)}}(O,a):O;if(document.addEventListener("click",function(t){let e=t.target;for(;e&&e!==document;){if(e.hasAttribute("data-rybbit-event")){let r=e.getAttribute("data-rybbit-event");if(r){let a={};for(let i of e.attributes)if(i.name.startsWith("data-rybbit-prop-")){let n=i.name.replace("data-rybbit-prop-","");a[n]=i.value}I("custom_event",r,a)}break}e=e.parentElement}if(s){let l=t.target.closest("a");if(!l||!l.href)return;(function t(e){try{let r=window.location.hostname,a=new URL(e).hostname;return a!==r&&""!==a}catch(i){return!1}})(l.href)&&I("outbound","",{url:l.href,text:l.innerText||l.textContent||"",target:l.target||"_self"})}}),n){let U=history.pushState,x=history.replaceState;history.pushState=function(...t){U.apply(this,t),P()},history.replaceState=function(...t){x.apply(this,t),P()},window.addEventListener("popstate",P),window.addEventListener("hashchange",P)}window.rybbit={pageview:O,event:(t,e={})=>I("custom_event",t,e),trackOutbound:(t,e="",r="_self")=>I("outbound","",{url:t,text:e,target:r}),identify(t){if("string"!=typeof t||""===t.trim()){console.error("User ID must be a non-empty string");return}g=t.trim();try{localStorage.setItem("rybbit-user-id",g)}catch(e){console.warn("Could not persist user ID to localStorage")}},clearUserId(){g=null;try{localStorage.removeItem("rybbit-user-id")}catch(t){}},getUserId:()=>g},i&&O()}();